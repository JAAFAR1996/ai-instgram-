# ุชูุฑูุฑ ุฅุตูุงุญ ุงููุดุงูู ุงูุฌุฐุฑูุฉ - Instagram AI Platform

## ๐ ููุฎุต ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ

ุชู ุชุทุจูู ุงูุฅุตูุงุญุงุช ุงูุชุงููุฉ ุจุดูู ุญุฑูู ูุญู ุงููุดุงูู ุงูุฌุฐุฑูุฉ ุงููุญุฏุฏุฉ:

### โ 1. ุฅูุดุงุก ุฎุฏูุฉ Username Resolver
**ุงูููู:** `src/services/username-resolver.ts`

- **ุงููุธููุฉ:** ุชุญููู username ุฅูู IG User ID ุจุงุณุชุฎุฏุงู Business Discovery API
- **ุงูุทุฑููุฉ ุงูุฑุณููุฉ:** `GET /{businessAccountId}?fields=business_discovery.username({username}){id,username}`
- **ุงูููุฒุงุช:**
  - ูุนุงูุฌุฉ ุฃุฎุทุงุก ุดุงููุฉ
  - Batch processing ููุนุฏูุฏ ูู usernames
  - Rate limiting protection

### โ 2. ุชูุญูุฏ ManyChat ุนูู Username
**ุงููููุงุช:**
- `src/database/migrations/054_manychat_username_only.sql`
- `src/repositories/manychat.repo.ts`

**ุงูุชุบููุฑุงุช:**
- ุฅุถุงูุฉ ุนููุฏ `instagram_username` ูู ุฌุฏูู `manychat_subscribers`
- ุชุฑุญูู ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ ูู `instagram_customer_id` ู `instagram_user_id`
- ุฅูุดุงุก ููุงุฑุณ ุฌุฏูุฏุฉ ููู username
- ุชุญุฏูุซ ุฌููุน ุงูุฏูุงู ูุงุณุชุฎุฏุงู username ุจุฏูุงู ูู ID

### โ 3. ุชูุธูู ูุงูุฐุฉ ุงูุฑุณุงุฆู
**ุงูููู:** `src/database/migrations/055_backfill_username_windows.sql`

- ุชุบููุฑ ููุน ุงูุนููุฏ `customer_instagram` ุฅูู TEXT
- ุฅุถุงูุฉ ููุงุฑุณ ููุจุญุซ ุจุงูู username
- ุชูุซูู ุฃู ุงูุนููุฏ ูุญุชูู ุนูู username ูููุณ ID

### โ 4. ุฅุตูุงุญ Webhook
**ุงูููู:** `src/routes/webhooks.ts`

**ุงูุชุบููุฑุงุช:**
- ุฅุฒุงูุฉ ุฎูุท username ู ID
- ุฅุฌุจุงุฑ ุงุณุชุฎุฏุงู `instagram_username` ููุท
- ุฅุฑุฌุงุน ุฎุทุฃ 400 ุฅุฐุง ูู ูุชู ุชูููุฑ username
- ุชูุฑูุฑ username ูุฌููุน ุงูุทุจูุงุช

### โ 5. ุฅุถุงูุฉ ุญุงุฑุณ RPD ูู OpenAI
**ุงูููู:** `src/services/instagram-ai.ts`

**ุงูุชุบููุฑุงุช:**
- ุฅุถุงูุฉ try/catch ุญูู ุฌููุน ุงุณุชุฏุนุงุกุงุช `openai.chat.completions.create`
- ูุดู ุฃุฎุทุงุก 429 ู rate limit
- ุฅุฑุฌุงุน fallback response ุซุงุจุช ุจุฏูุงู ูู ุฅุนุงุฏุฉ ุงููุญุงููุฉ
- ุชุทุจูู ุนูู ุฌููุน ุงูุฏูุงู:
  - `generateInstagramResponse`
  - `generateStoryReply`
  - `generateCommentResponse`

### โ 6. ุชุญููู Username ุฅูู ID ุนูุฏ ุงูุฅุฑุณุงู
**ุงูููู:** `src/services/instagram-message-sender.ts`

**ุงูุชุบููุฑุงุช:**
- ุชุบููุฑ `sendTextMessage` ูุงุณุชูุจุงู username ุจุฏูุงู ูู ID
- ุงุณุชุฎุฏุงู `resolveIgIdByUsername` ูุชุญููู username ุฅูู ID
- Fallback ุฅูู ManyChat ุฅุฐุง ูุดู ุงูุชุญููู
- ูุตู ููุทู ุงูุฅุฑุณุงู ุฅูู ุฏูุงู ูููุตูุฉ:
  - `sendViaGraphAPI`
  - `sendViaManyChat`

## ๐ฏ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

### 1. ุฅููุงู ุชูุฑุงุฑ ุฃุฎุทุงุก 429
- **ุงูุณุจุจ:** ุญุงุฑุณ RPD ูููุน ุฅุนุงุฏุฉ ุงููุญุงููุฉ
- **ุงููุชูุฌุฉ:** ุฑุณุงุฆู fallback ุซุงุจุชุฉ ุจุฏูุงู ูู ุชูุฑุงุฑ ุงูุฃุฎุทุงุก

### 2. ุนูู ูุงูุฐุฉ 24 ุณุงุนุฉ
- **ุงูุณุจุจ:** ุชูุญูุฏ ุงุณุชุฎุฏุงู username ูู ุฌููุน ุงูุทุจูุงุช
- **ุงููุชูุฌุฉ:** ุชุชุจุน ุตุญูุญ ูููุญุงุฏุซุงุช

### 3. ุชูุงูู ManyChat
- **ุงูุณุจุจ:** ุฅุตูุงุญ ุชุนุงุฑุถ ุฃุนูุฏุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
- **ุงููุชูุฌุฉ:** ุฑุจุท ุตุญูุญ ุจูู Instagram ู ManyChat

### 4. ุฅุฑุณุงู ูุงุฌุญ
- **ุงูุณุจุจ:** ุชุญููู username ุฅูู ID ุจุงุณุชุฎุฏุงู Business Discovery
- **ุงููุชูุฌุฉ:** ุฅุฑุณุงู ุนุจุฑ Graph API ุฃู ManyChat

## ๐ง ุฎุทูุงุช ุงูุชุทุจูู

### 1. ุชุดุบูู Migrations
```bash
# ุชุดุบูู migration 054
npm run migrate:up 054

# ุชุดุบูู migration 055
npm run migrate:up 055
```

### 2. ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุฏูุฉ
```bash
npm run build
npm run start
```

### 3. ุงุฎุชุจุงุฑ ุงููุธุงุฆู
- ุฅุฑุณุงู ุฑุณุงูุฉ ุฌุฏูุฏุฉ
- ุงูุชุญูู ูู ุนูู ูุงูุฐุฉ 24 ุณุงุนุฉ
- ุงูุชุฃูุฏ ูู ุนุฏู ุชูุฑุงุฑ ุฃุฎุทุงุก 429

## ๐ ูุฑุงูุจุฉ ุงููุชุงุฆุฌ

### ูุคุดุฑุงุช ุงููุฌุงุญ:
1. **ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก 429** ูู ุงูุณุฌูุงุช
2. **ุฑุณุงุฆู fallback ุซุงุจุชุฉ** ุนูุฏ ููุงุฏ ุงูุญุตุฉ
3. **ุนูู ูุงูุฐุฉ 24 ุณุงุนุฉ** ุจุดูู ุตุญูุญ
4. **ุฑุจุท ManyChat** ูุงุฌุญ

### ุงูุณุฌูุงุช ุงููุทููุจ ูุฑุงูุจุชูุง:
```json
{
  "level": "info",
  "message": "โ Resolved username to IG ID, sending via Graph API",
  "username": "user123",
  "igId": "178414123456789"
}
```

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### 1. Business Discovery API
- ูุชุทูุจ ุญุณุงุจ ูููู ูุฑุชุจุท ุจุตูุญุฉ
- ูุญุชุงุฌ ุฃุฐููุงุช ููุงุณุจุฉ ูู Meta
- ูุฏ ูููู ูุญุฏูุฏ ูู ุจุนุถ ุงูุญุงูุงุช

### 2. ManyChat Integration
- ูุฌุจ ุฃู ูููู ุงููุณุชุฎุฏู ูุณุฌู ูู ManyChat ุฃููุงู
- ูุฏ ูุญุชุงุฌ ุฅุนุฏุงุฏ ุฅุถุงูู ูู ManyChat

### 3. Rate Limiting
- ุญุงุฑุณ RPD ูููุน ุงูุชูุฑุงุฑ ููู ูุง ูุญู ูุดููุฉ ููุงุฏ ุงูุญุตุฉ
- ูุฏ ุชุญุชุงุฌ ุชุฑููุฉ ุฎุทุฉ OpenAI

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. **ูุฑุงูุจุฉ ุงูุฃุฏุงุก** ููุฏุฉ 24-48 ุณุงุนุฉ
2. **ุชุญุฏูุซ ุฎุทุฉ OpenAI** ุฅุฐุง ุงุณุชูุฑุช ูุดุงูู ุงูุญุตุฉ
3. **ุชุญุณูู Business Discovery** ุฅุฐุง ูุดู ุงูุชุญููู
4. **ุฅุถุงูุฉ monitoring** ุดุงูู ูููุธุงุฆู ุงูุฌุฏูุฏุฉ

---

**ุชู ุชุทุจูู ุฌููุน ุงูุฅุตูุงุญุงุช ุจูุฌุงุญ! ๐**
