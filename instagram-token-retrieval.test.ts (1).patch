--- /mnt/data/work/src4/src/tests/instagram-token-retrieval.test.ts
+++ /mnt/data/work/src4/src/tests/instagram-token-retrieval.test.ts
@@ -1,15 +1,16 @@
-process.env.JWT_SECRET = process.env.JWT_SECRET || 'test_jwt_secret';
-process.env.DB_HOST = process.env.DB_HOST || 'localhost';
-process.env.DB_PORT = process.env.DB_PORT || '5432';
-process.env.DB_NAME = process.env.DB_NAME || 'test_db';
-process.env.DB_USER = process.env.DB_USER || 'test_user';
-process.env.DB_PASSWORD = process.env.DB_PASSWORD || 'test_pass';
-process.env.INTERNAL_API_KEY = process.env.INTERNAL_API_KEY || '0123456789abcdef';
-process.env.BASE_URL = process.env.BASE_URL || 'http://localhost';
-process.env.MERCHANT_ID = process.env.MERCHANT_ID || 'merchant1';
+getEnv('JWT_SECRET') = getEnv('JWT_SECRET') || 'test_jwt_secret';
+getEnv('DB_HOST') = getEnv('DB_HOST') || 'localhost';
+getEnv('DB_PORT') = getEnv('DB_PORT') || '5432';
+getEnv('DB_NAME') = getEnv('DB_NAME') || 'test_db';
+getEnv('DB_USER') = getEnv('DB_USER') || 'test_user';
+getEnv('DB_PASSWORD') = getEnv('DB_PASSWORD') || 'test_pass';
+getEnv('INTERNAL_API_KEY') = getEnv('INTERNAL_API_KEY') || '0123456789abcdef';
+getEnv('BASE_URL') = getEnv('BASE_URL') || 'http://localhost';
+getEnv('MERCHANT_ID') = getEnv('MERCHANT_ID') || 'merchant1';
 
 import { describe, test, expect, mock } from 'bun:test';
 import { getEncryptionService } from '../services/encryption.js';
+import { getEnv } from '../config/env.js';
 
 const encryption = getEncryptionService();
 
@@ -87,4 +88,4 @@
     expect(res.success).toBe(true);
     expect(fetchMock.mock.calls.length).toBe(1);
   });
-});
+});