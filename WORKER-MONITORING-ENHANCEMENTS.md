# ุชุญุณููุงุช ูุฑุงูุจุฉ Queue Workers

## ๐ฏ ุงููุฏู
ุชุญุณูู ูุฑุงูุจุฉ ูุชุชุจุน Workers ูู ูุธุงู ุงูุทูุงุจูุฑ ุงูุฅูุชุงุฌู ูุถูุงู ูุนุงูุฌุฉ ุงูููุงู ุจุดูู ุตุญูุญ ููุดู ุงููุดุงูู ูุจูุฑุงู.

## โจ ุงูุชุญุณููุงุช ุงููุถุงูุฉ

### 1. ูุฑุงูุจุฉ ุจุฏุก Workers
- **ุชุญุฐูุฑ ูุจูุฑ**: ุฅุฐุง ูู ุชุจุฏุฃ Workers ูู ุงููุนุงูุฌุฉ ุฎูุงู 10 ุซูุงูู
- **ุชุชุจุน ุญุงูุฉ ุงูุจุฏุก**: ูุฑุงูุจุฉ ุฃูู ูููุฉ ูุชู ูุนุงูุฌุชูุง
- **ุชุฃููุฏ ุงูุชุดุบูู**: ุฑุณุงุฆู ุชุฃููุฏ ุนูุฏ ุจุฏุก ุงููุนุงูุฌุฉ ุงูุฃููู

```typescript
const workerInitTimeout = setTimeout(() => {
  this.logger.warn('โ๏ธ Workers ูู ุชุจุฏุฃ ูู ุงููุนุงูุฌุฉ ุฎูุงู 10 ุซูุงูู');
}, 10000);

// ุฅูุบุงุก ุงูุชุญุฐูุฑ ุนูุฏ ูุนุงูุฌุฉ ุฃูู ูููุฉ
clearTimeout(workerInitTimeout);
```

### 2. ุชุญุฏูุฏ Workers ูุฑูุฏ
- **Worker ID**: ูุนุฑู ูุฑูุฏ ููู Worker: `worker-${random}`
- **ุชุชุจุน ูุชูุฏู**: ุชุณุฌูู ููุตู ููู Worker
- **ุฅุญุตุงุฆูุงุช ุงูุฃุฏุงุก**: ููุงุณ throughput ููู Worker

```typescript
const workerId = `worker-${Math.random().toString(36).substr(2, 9)}`;
const webhookWorkerId = `webhook-worker-${Math.random().toString(36).substr(2, 6)}`;
const aiWorkerId = `ai-worker-${Math.random().toString(36).substr(2, 6)}`;
```

### 3. ูุฑุงูุจุฉ ุตุญุฉ Workers ุงูุฏูุฑูุฉ

#### ูุญุต ูู ุฏูููุฉ (`checkWorkerHealth`)
- **ูุดู ุงูุชุนุทู**: ููุงู ูู ุงูุงูุชุธุงุฑ ููู ูุง ูุนุงูุฌุฉ ูุดุทุฉ
- **ุงูููุงู ุงูุนุงููุฉ**: ูุดู ุงูููุงู ุงููุดุทุฉ ูุฃูุซุฑ ูู ุฏูููุชูู
- **ุงูุชุญุฐูุฑุงุช ุงููุจูุฑุฉ**: ุชูุจููุงุช ุนูุฏ ุชุฑุงูู ุงูููุงู
- **ุงูุฅุญุตุงุฆูุงุช ุงูุฅูุฌุงุจูุฉ**: ุชุฃููุฏ ุงูุนูู ุงูุทุจูุนู

```typescript
// ูุญุต ุฅุฐุง ูุงูุช ููุงู ููุงู ูู ุงูุงูุชุธุงุฑ ููู ูุง ูุชู ูุนุงูุฌุชูุง
if (stats.waiting > 0 && stats.active === 0) {
  this.logger.warn('๐จ ููุงู ูู ุงูุงูุชุธุงุฑ ููู ูุง ุชูุฌุฏ ูุนุงูุฌุฉ ูุดุทุฉ');
  
  if (stats.waiting > 10 && 
      (!this.lastProcessedAt || now - this.lastProcessedAt.getTime() > 300000)) {
    this.logger.error('๐ฅ Workers ูุนุทูุฉ - ูุญุงููุฉ ุฅุนุงุฏุฉ ุชุดุบูู ุงููุนุงูุฌุงุช');
  }
}
```

### 4. ุชุญุณูู ุชูุฑูุฑ ุตุญุฉ ุงููุธุงู (`getQueueHealth`)

#### ูุคุดุฑุงุช ูุญุณููุฉ:
- **ุชุญููู ุฏููู ูููุดุงูู**: ูุญุต ุงูููุช ููุฐ ุขุฎุฑ ูุนุงูุฌุฉ
- **ุชูุตูุงุช ุฐููุฉ**: ูุตุงุฆุญ ูุญุฏุฏุฉ ุญุณุจ ููุน ุงููุดููุฉ
- **ูุนุฏู ุงููุนุงูุฌุฉ**: ููุงุณ ุฃุฏุงุก Workers
- **ูุญุต ุงูุชุฑุงูู**: ุชุญุฐูุฑุงุช ูุชุฏุฑุฌุฉ ุญุณุจ ุนุฏุฏ ุงูููุงู

```typescript
if (stats.waiting > 10 && stats.active === 0) {
  const timeSinceLastProcess = this.lastProcessedAt ? Date.now() - this.lastProcessedAt.getTime() : null;
  
  if (!timeSinceLastProcess || timeSinceLastProcess > 120000) {
    healthy = false;
    recommendations.push('๐จ ูุง ุชูุฌุฏ ูุนุงูุฌุฉ ูุดุทุฉ - Workers ูุนุทูุฉ');
  }
}

// ูุญุต ูุนุฏู ุงููุนุงูุฌุฉ
const processingRate = this.processedJobs > 0 ? this.processedJobs / (Date.now() / 60000) : 0;
if (processingRate < 1 && stats.waiting > 5) {
  recommendations.push('๐ ูุนุฏู ูุนุงูุฌุฉ ููุฎูุถ - ูุฏ ุชุญุชุงุฌ ุงููุฒูุฏ ูู Workers');
}
```

### 5. ุชุณุฌูู ููุตู ูููุนุงูุฌุฉ

#### ูุนูููุงุช ุดุงููุฉ ููู ูููุฉ:
- **Worker ID**: ุชุญุฏูุฏ Worker ุงููุณุคูู
- **ุฅุญุตุงุฆูุงุช ุงููุงุฆูุฉ**: ุนุฏุฏ ุงูููุงู ูู ุงูุงูุชุธุงุฑ ูุงููุดุทุฉ
- **ุงูุฃุฏุงุก**: ุฒูู ุงููุนุงูุฌุฉ ู throughput
- **ููุน ุงูุฎุทุฃ**: ุชุญุฏูุฏ ุฏููู ูุฃููุงุน ุงูุฃุฎุทุงุก
- **ุญุงูุฉ ุฅุนุงุฏุฉ ุงููุญุงููุฉ**: ูุชู ุณูุชู ุฅุนุงุฏุฉ ุงููุญุงููุฉ

```typescript
this.logger.info(`โก Worker ${workerId} - ุจุฏุก ูุนุงูุฌุฉ ูููุฉ`, {
  workerId,
  jobId: job.id,
  type: job.data.type || job.name,
  queueStatus: {
    waiting: await this.queue!.getWaiting().then(jobs => jobs.length),
    active: await this.queue!.getActive().then(jobs => jobs.length)
  }
});

// ุนูุฏ ุงูุฅูุฌุงุฒ
this.logger.info(`โ Worker ${workerId} - ูููุฉ ููุชููุฉ ุจูุฌุงุญ`, {
  workerId,
  duration: `${duration}ms`,
  throughput: Math.round(1000 / duration * 100) / 100 // ููุงู/ุซุงููุฉ
});
```

## ๐ง ุงุณุชุฎุฏุงู ุงูุชุญุณููุงุช

### 1. ุงูุชุดุบูู ุงูุนุงุฏู
```typescript
const queueManager = new ProductionQueueManager(redisUrl, logger, environment);
await queueManager.initialize(); // ุณูุจุฏุฃ ูุฑุงูุจุฉ Workers ุชููุงุฆูุงู
```

### 2. ูุญุต ุตุญุฉ Workers
```typescript
const health = await queueManager.getQueueHealth();
console.log('ุญุงูุฉ Workers:', health.workerStatus);
console.log('ุงูุชูุตูุงุช:', health.recommendations);
```

### 3. ุงุฎุชุจุงุฑ ุงููุธุงู
```bash
# ุชุดุบูู ุงุฎุชุจุงุฑ ูุฑุงูุจุฉ Workers
node test-worker-monitoring.js
```

## ๐ ุงููุคุดุฑุงุช ุงูุฌุฏูุฏุฉ

### ุญุงูุฉ Workers
- `isProcessing`: ูู ูุชู ูุนุงูุฌุฉ ููุงู ุญุงููุงู
- `activeWorkers`: ุนุฏุฏ Workers ุงููุดุทุฉ
- `delayedJobs`: ุงูููุงู ุงููุคุฌูุฉ
- `processingCapacity`: ุงููุฏุฑุฉ ุงููุตูู ูููุนุงูุฌุฉ

### ุงูุชูุตูุงุช ุงูุชููุงุฆูุฉ
- **๐จ Workers ูุนุทูุฉ**: ุนุฏู ูุฌูุฏ ูุนุงูุฌุฉ ุฑุบู ูุฌูุฏ ููุงู
- **โก ุชุฌูุน ููุงู**: ุชุฑุงูู ููุงู ูู ุงูุงูุชุธุงุฑ
- **๐ ุฃุฏุงุก ููุฎูุถ**: ูุนุฏู ูุนุงูุฌุฉ ุจุทูุก
- **โ๏ธ ุชุฑุงูู ูุจูุฑ**: ุนุฏุฏ ูุจูุฑ ูู ุงูููุงู ุงูููุชุธุฑุฉ

## ๐ฏ ุงูููุงุฆุฏ

1. **ูุดู ูุจูุฑ ูููุดุงูู**: ุชุญุฏูุฏ ุชุนุทู Workers ูุจู ุชุฃุซูุฑูุง ุนูู ุงููุธุงู
2. **ูุฑุงูุจุฉ ุดุงููุฉ**: ุชุชุจุน ูู ุฌุงูุจ ูู ุฃุฏุงุก Workers
3. **ุชุดุฎูุต ุฏููู**: ุชุญุฏูุฏ ุงูุณุจุจ ุงูุฌุฐุฑู ูููุดุงูู
4. **ุชูุตูุงุช ุนูููุฉ**: ูุตุงุฆุญ ูุญุฏุฏุฉ ูุญู ุงููุดุงูู
5. **ุชุญุณูู ุงูุฃุฏุงุก**: ููุงุณ ูุชุญุณูู throughput

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. **ูุฑุงูุจุฉ ุงูุฅูุชุงุฌ**: ุชุชุจุน ุฃุฏุงุก ุงููุธุงู ูู ุงูุจูุฆุฉ ุงูุฅูุชุงุฌูุฉ
2. **ุชุญููู ุงูุจูุงูุงุช**: ุฌูุน ุฅุญุตุงุฆูุงุช ูุชุญุณูู ุงูุฃุฏุงุก
3. **ุงูุชุญุณูู ุงููุณุชูุฑ**: ุชุทููุฑ ูุคุดุฑุงุช ุฅุถุงููุฉ ุญุณุจ ุงูุญุงุฌุฉ
4. **ุงูุชูุจููุงุช**: ุฅุถุงูุฉ ุชูุจููุงุช ุชููุงุฆูุฉ ูููุดุงูู ุงูุญุฑุฌุฉ

## โ ุงูุฎูุงุตุฉ

ุชู ุชุญุณูู ูุฑุงูุจุฉ Workers ุจุดูู ุดุงูู ูุถูุงู:
- โ ุจุฏุก Workers ุจูุฌุงุญ
- โ ูุนุงูุฌุฉ ุงูููุงู ุจุงุณุชูุฑุงุฑ  
- โ ูุดู ุงููุดุงูู ูุจูุฑุงู
- โ ุชูุตูุงุช ุนูููุฉ ููุญู
- โ ูุฑุงูุจุฉ ุฏูุฑูุฉ ุดุงููุฉ

ุงููุธุงู ุงูุขู ูุงุฏุฑ ุนูู ุชุญุฏูุฏ ููุนุงูุฌุฉ ูุดุงูู Workers ุชููุงุฆูุงู ูุน ุชุณุฌูู ููุตู ูุฌููุน ุงูุนูููุงุช.